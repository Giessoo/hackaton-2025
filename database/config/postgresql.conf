# -----------------------------
# PostgreSQL configuration file
# -----------------------------

#------------------------------------------------------------------------------
# CONNECTIONS AND AUTHENTICATION
#------------------------------------------------------------------------------

listen_addresses = '*'     # Ожидать подключения только с localhost
port = 5432                       # Порт по умолчанию
max_connections = 100             # Максимальное число подключений
superuser_reserved_connections = 3 # Резерв для суперпользователей

#------------------------------------------------------------------------------
# RESOURCE USAGE (except WAL)
#------------------------------------------------------------------------------

shared_buffers = 128MB            # Буфер в RAM для кэширования данных
work_mem = 4MB                    # Память для операций сортировки и хэшей
maintenance_work_mem = 64MB       # Память для VACUUM, CREATE INDEX и т. д.
effective_cache_size = 4GB        # Оценка доступного кэша ОС для планировщика

#------------------------------------------------------------------------------
# WRITE-AHEAD LOG (WAL)
#------------------------------------------------------------------------------

wal_level = replica               # Минимальный уровень журналирования (для репликации)
synchronous_commit = on           # Гарантия записи WAL перед подтверждением транзакции
wal_buffers = -1                  # Автонастройка (обычно 1/32 от shared_buffers)

#------------------------------------------------------------------------------
# REPLICATION
#------------------------------------------------------------------------------

max_wal_senders = 10              # Макс. число процессов для репликации
hot_standby = on                  # Разрешить подключения к standby-серверу

#------------------------------------------------------------------------------
# QUERY TUNING
#------------------------------------------------------------------------------

random_page_cost = 4.0            # Стоимость чтения случайной страницы
effective_io_concurrency = 1      # Параллельные дисковые операции (SSD: 200+)
max_parallel_workers_per_gather = 2 # Макс. число параллельных процессов

#------------------------------------------------------------------------------
# LOGGING
#------------------------------------------------------------------------------

logging_collector = on            # Включить сбор логов
log_directory = 'log'             # Директория для логов
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log' # Формат имени файла
log_rotation_age = 1d             # Ротация логов каждый день
log_min_messages = warning        # Минимальный уровень логирования
log_min_error_statement = error   # Логировать SQL при ошибках

#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

autovacuum = on                   # Включить автоочистку
autovacuum_max_workers = 3        # Макс. число процессов автоочистки
autovacuum_naptime = 1min         # Пауза между проверками

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

datestyle = 'iso, mdy'            # Формат даты
timezone = 'UTC'                  # Часовой пояс сервера
lc_messages = 'en_US.UTF-8'       # Язык сообщений
lc_monetary = 'en_US.UTF-8'      # Локализация для денежных единиц
lc_numeric = 'en_US.UTF-8'        # Локализация для чисел
lc_time = 'en_US.UTF-8'           # Локализация для времени

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

deadlock_timeout = 1s             # Время ожидания перед проверкой deadlock
max_locks_per_transaction = 64    # Макс. число блокировок на транзакцию
